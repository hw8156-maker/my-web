<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>í˜œì›ì˜ í”„ë¡œì íŠ¸ í˜ì´ì§€</title>
</head>

<body>
    <h1>ë‚´ ì›¹í˜ì´ì§€</h1>
    <p>ì•„ë˜ëŠ” MQTT ë©”ì‹œì§€ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ í‘œì‹œí•˜ëŠ” ì˜ì—­ì…ë‹ˆë‹¤.</p>

    <div style="margin-top:30px; padding:20px; background:#f0f0f0; border-radius:10px;">
        <h2>ğŸ“¡ MQTT ë©”ì‹œì§€</h2>
        <div id="mqtt-box" style="font-size:20px; color:#333; font-weight:bold;">
            (ë©”ì‹œì§€ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...)
        </div>
    </div>

    <!-- âœ… ë¸Œë¼ìš°ì €ìš© MQTT WebSocket ë¼ì´ë¸ŒëŸ¬ë¦¬(mqttws31) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js"></script>

    <script>
        console.log("ğŸš€ Paho MQTT library loaded:", typeof Paho);

        // ===== MQTT ì„¤ì • =====
        const host = "test.mosquitto.org";  // ë¸Œë¡œì»¤ ì£¼ì†Œ
        const port = 8081;                  // WebSocket í¬íŠ¸
        const path = "/mqtt";               // WebSocket ê²½ë¡œ
        const clientID = "webclient_" + Math.random().toString(16).substr(2, 8);

        // âœ… ë¸Œë¼ìš°ì €ìš© PahoëŠ” ì´ë ‡ê²Œ ìƒì„±í•´ì•¼ í•¨ (host, port, path, clientID)
        const client = new Paho.MQTT.Client(host, port, path, clientID);

        client.onConnectionLost = function(responseObject) {
            console.log("MQTT Connection Lost:", responseObject.errorMessage);
        };

        client.onMessageArrived = function(message) {
            console.log("MQTT Message Arrived:", message.payloadString);
            document.getElementById("mqtt-box").innerText = message.payloadString;
        };

        client.connect({
            useSSL: true,   // wss ì´ë¯€ë¡œ true
            onSuccess: function () {
                console.log("âœ… MQTT Connected!");
                client.subscribe("ewha/2270095");
                console.log("âœ… Subscribed to topic: ewha/2270095");
            },
            onFailure: function (err) {
                console.log("âŒ MQTT Connect failed:", err);
            }
        });
    </script>

</body>
</html>
